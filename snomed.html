<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHS Christmas SNOMED Flashcards</title>
    <!-- Include html2canvas library for screenshot functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --nhs-blue: #005EB8;
            --nhs-dark-blue: #003087;
            --nhs-white: #FFFFFF;
            --nhs-black: #231f20;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: "Frutiger", "Arial", sans-serif;
            background-color: #f0f4f5;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: var(--nhs-blue);
            margin-bottom: 2rem;
            text-align: center;
        }

        .controls {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            background-color: var(--nhs-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: var(--nhs-dark-blue);
        }
        
        button:disabled {
            background-color: var(--nhs-black);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .card {
            background-color: var(--nhs-blue);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            aspect-ratio: 3/4;
            position: relative;
            cursor: pointer;
            perspective: 1000px;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1.5rem 1rem;
            box-sizing: border-box;
            border-radius: 12px;
        }

        .card-front {
            background-color: var(--nhs-blue);
            color: white;
        }

        .card-back {
            background-color: var(--nhs-white);
            color: var(--nhs-blue);
            transform: rotateY(180deg);
            justify-content: center;
            align-items: center;
            border: 2px solid var(--nhs-blue);
        }

        .snomed-code {
            font-size: 1.2rem;
            font-weight: bold;
            letter-spacing: 0.5px;
            background: rgba(0,0,0,0.1);
            padding: 4px 8px;
            border-radius: 6px;
            align-self: center;
        }

        /* Frame Style for Graphics */
        .graphic-frame {
            width: 80%;
            aspect-ratio: 1;
            background-color: rgba(255, 255, 255, 0.1);
            border: 4px solid white;
            border-radius: 20px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px auto;
            box-sizing: border-box;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .graphic-frame svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2));
        }

        /* Smaller graphic on the back */
        .card-back .graphic-frame {
            width: 30%;
            border-width: 2px;
            background-color: rgba(0, 94, 184, 0.1); /* Light blue bg for back */
            border-color: var(--nhs-blue);
            margin-bottom: 1rem;
        }

        .description {
            font-size: 1.1rem;
            font-weight: 600;
            line-height: 1.4;
            min-height: 3em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-back .definition {
            font-size: 1.1rem;
            padding: 1rem;
        }

    </style>
</head>
<body>

    <h1>NHS Christmas SNOMED Codes</h1>

    <div class="controls">
        <button onclick="flipAll()">Flip All</button>
        <button onclick="shuffleCards()">Shuffle</button>
        <button onclick="downloadAll()">Download All Images</button>
    </div>

    <div class="grid-container" id="cardGrid">
        <!-- Cards will be injected here via JS -->
    </div>

    <script>
        const outlineColor = "#2c3e50";
        const strokeWidth = "3";

        // SVG Definitions
        const icons = {
            cake: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20 50 L20 80 Q20 95 50 95 Q80 95 80 80 L80 50" fill="#D2691E" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M18 50 Q18 30 50 30 Q82 30 82 50 Q75 65 65 55 Q55 65 45 55 Q35 65 25 55 Q18 60 18 50" fill="#FFF" stroke="${outlineColor}" stroke-width="${strokeWidth}" stroke-linejoin="round"/><circle cx="50" cy="30" r="10" fill="#E74C3C" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M50 20 L55 10" stroke="${outlineColor}" stroke-width="${strokeWidth}" fill="none"/></svg>`,
            
            mincePie: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M15 45 L25 80 Q50 95 75 80 L85 45" fill="#F4A460" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><ellipse cx="50" cy="45" rx="38" ry="15" fill="#DEB887" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M50 35 L55 42 L63 42 L57 47 L59 55 L50 50 L41 55 L43 47 L37 42 L45 42 Z" fill="#F4A460" stroke="${outlineColor}" stroke-width="2"/></svg>`,
            
            pudding: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20 85 Q20 95 50 95 Q80 95 80 85 L80 50 Q80 20 50 20 Q20 20 20 50 Z" fill="#3E2723" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M20 50 Q20 20 50 20 Q80 20 80 50 Q70 65 60 55 Q50 65 40 55 Q30 65 20 50" fill="#FFF" stroke="${outlineColor}" stroke-width="${strokeWidth}" stroke-linejoin="round"/><circle cx="45" cy="20" r="6" fill="#D32F2F" stroke="${outlineColor}" stroke-width="2"/><circle cx="55" cy="20" r="6" fill="#D32F2F" stroke="${outlineColor}" stroke-width="2"/><path d="M50 20 Q65 5 70 15 Q75 5 60 15" fill="#2E7D32" stroke="${outlineColor}" stroke-width="2"/><path d="M50 20 Q35 5 30 15 Q25 5 40 15" fill="#2E7D32" stroke="${outlineColor}" stroke-width="2"/></svg>`,
            
            gfPudding: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20 85 Q20 95 50 95 Q80 95 80 85 L80 50 Q80 20 50 20 Q20 20 20 50 Z" fill="#5D4037" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M20 50 Q20 20 50 20 Q80 20 80 50 Q70 65 60 55 Q50 65 40 55 Q30 65 20 50" fill="#FFF" stroke="${outlineColor}" stroke-width="${strokeWidth}" stroke-linejoin="round"/><line x1="50" y1="20" x2="50" y2="5" stroke="${outlineColor}" stroke-width="3"/><rect x="50" y="5" width="30" height="20" fill="#FFC107" stroke="${outlineColor}" stroke-width="2"/><text x="65" y="20" font-family="Arial" font-weight="bold" font-size="12" text-anchor="middle" fill="${outlineColor}">GF</text></svg>`,
            
            island: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M5 85 Q50 95 95 85" stroke="#29B6F6" stroke-width="5" fill="none" stroke-linecap="round"/><path d="M20 85 Q50 65 80 85 Z" fill="#F4A460" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M50 75 Q60 50 50 30" stroke="#8D6E63" stroke-width="6" fill="none" stroke-linecap="round"/><path d="M50 30 Q75 10 85 40 M50 30 Q25 10 15 40 M50 30 Q50 0 50 20" stroke="#43A047" stroke-width="5" fill="none" stroke-linecap="round"/></svg>`,
            
            snowmobile: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20 80 L80 80 L75 65 L25 65 Z" fill="#333" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M25 65 L35 45 L70 45 L80 65 Z" fill="#D32F2F" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M70 80 L90 70" stroke="${outlineColor}" stroke-width="4" stroke-linecap="round"/><path d="M60 45 L55 35 L75 35" stroke="${outlineColor}" stroke-width="3" fill="none"/></svg>`,
            
            chimney: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="30" y="40" width="40" height="50" fill="#B71C1C" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><rect x="25" y="30" width="50" height="15" fill="#D32F2F" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><line x1="30" y1="55" x2="70" y2="55" stroke="${outlineColor}" stroke-width="1" opacity="0.5"/><line x1="30" y1="70" x2="70" y2="70" stroke="${outlineColor}" stroke-width="1" opacity="0.5"/><path d="M40 30 L35 10 L45 10 L45 30" fill="#D32F2F" stroke="${outlineColor}" stroke-width="2"/><path d="M60 30 L65 10 L55 10 L55 30" fill="#D32F2F" stroke="${outlineColor}" stroke-width="2"/><path d="M35 10 L45 10 L45 5 L35 5 Z" fill="#111" stroke="${outlineColor}" stroke-width="2"/><path d="M65 10 L55 10 L55 5 L65 5 Z" fill="#111" stroke="${outlineColor}" stroke-width="2"/></svg>`,
            
            coal: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M25 60 Q20 40 40 30 Q60 20 80 40 Q90 60 70 80 Q50 90 30 80 Q15 70 25 60 Z" fill="#424242" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M35 45 Q45 40 55 50" stroke="#757575" stroke-width="3" fill="none" stroke-linecap="round"/><circle cx="70" cy="50" r="2" fill="#757575"/></svg>`,
            
            stocking: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M35 20 L65 20 L65 60 Q65 85 45 85 L30 85 Q20 85 20 70 L35 60 Z" fill="#D32F2F" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><rect x="30" y="20" width="40" height="15" rx="5" fill="#FFF" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><rect x="40" y="65" width="10" height="10" fill="#FFCA28" stroke="${outlineColor}" stroke-width="${strokeWidth}"/></svg>`,
            
            berries: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 50 Q20 30 20 50 Q20 70 50 50" fill="#43A047" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M50 50 Q80 30 80 50 Q80 70 50 50" fill="#43A047" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><path d="M50 50 Q50 10 30 20 Q10 30 50 50" fill="#43A047" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><circle cx="50" cy="50" r="10" fill="#D32F2F" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><circle cx="62" cy="58" r="9" fill="#D32F2F" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><circle cx="38" cy="58" r="9" fill="#D32F2F" stroke="${outlineColor}" stroke-width="${strokeWidth}"/></svg>`,
            
            chestnut: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 15 Q85 15 85 50 Q85 85 50 85 Q15 85 15 50 Q15 15 50 15" fill="#8BC34A" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><circle cx="50" cy="50" r="25" fill="#795548" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><ellipse cx="50" cy="45" rx="15" ry="10" fill="#A1887F"/></svg>`,
            
            mistletoe: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 20 L50 40" stroke="#43A047" stroke-width="3"/><ellipse cx="40" cy="50" rx="10" ry="20" fill="#66BB6A" stroke="${outlineColor}" stroke-width="${strokeWidth}" transform="rotate(-30 40 50)"/><ellipse cx="60" cy="50" rx="10" ry="20" fill="#66BB6A" stroke="${outlineColor}" stroke-width="${strokeWidth}" transform="rotate(30 60 50)"/><circle cx="50" cy="45" r="6" fill="#FFF" stroke="${outlineColor}" stroke-width="${strokeWidth}"/><circle cx="50" cy="58" r="6" fill="#FFF" stroke="${outlineColor}" stroke-width="${strokeWidth}"/></svg>`
        };

        const cardsData = [
            { code: "226651007", text: "Fancy iced cake (substance)", icon: icons.cake },
            { code: "226702000", text: "Mince pie (substance)", icon: icons.mincePie },
            { code: "227687005", text: "Christmas pudding (substance)", icon: icons.pudding },
            { code: "11784111000001106", text: "Lifestyle gluten free luxury christmas pudding (product)", icon: icons.gfPudding },
            { code: "1187207000", text: "Christmas Island (geographic location)", icon: icons.island },
            { code: "242128002", text: "Run over by motor-driven snow vehicle (event)", icon: icons.snowmobile },
            { code: "242409000", text: "Fall from chimney (event)", icon: icons.chimney },
            { code: "34323004", text: "Coal (substance)", icon: icons.coal },
            { code: "228184002", text: "Stocking (physical object)", icon: icons.stocking },
            { code: "242318004", text: "Accidental ingestion of christmas cherry berries (event)", icon: icons.berries },
            { code: "242348001", text: "Accidental ingestion of horse chestnut (event)", icon: icons.chestnut },
            { code: "242333007", text: "Accidental ingestion of mistletoe berries (event)", icon: icons.mistletoe }
        ];

        const grid = document.getElementById('cardGrid');

        function renderCards() {
            grid.innerHTML = '';
            cardsData.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = `card`; // All cards are standard NHS Blue now
                cardEl.onclick = () => cardEl.classList.toggle('flipped');

                cardEl.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="snomed-code">${card.code}</div>
                            <div class="graphic-frame">
                                ${card.icon}
                            </div>
                            <div class="description">${card.text}</div>
                        </div>
                        <div class="card-back">
                            <div class="graphic-frame">
                                ${card.icon}
                            </div>
                            <div class="definition">
                                <strong>Code:</strong> ${card.code}<br><br>
                                <strong>Term:</strong><br>${card.text}
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(cardEl);
            });
        }

        function flipAll() {
            const cards = document.querySelectorAll('.card');
            const anyFlipped = Array.from(cards).some(c => c.classList.contains('flipped'));
            
            cards.forEach(card => {
                if (anyFlipped) {
                    card.classList.remove('flipped');
                } else {
                    card.classList.add('flipped');
                }
            });
        }

        function shuffleCards() {
            for (let i = cardsData.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cardsData[i], cardsData[j]] = [cardsData[j], cardsData[i]];
            }
            renderCards();
        }
        
        async function downloadAll() {
            const btn = document.querySelector('button[onclick="downloadAll()"]');
            const originalText = btn.innerText;
            btn.innerText = 'Generating...';
            btn.disabled = true;

            // Container for rendering off-screen
            const container = document.createElement('div');
            container.style.position = 'fixed';
            container.style.top = '-9999px';
            container.style.left = '-9999px';
            container.style.width = '300px'; // Fixed width for consistent export
            document.body.appendChild(container);

            for (let i = 0; i < cardsData.length; i++) {
                const card = cardsData[i];
                
                // Render a temporary card explicitly for export (Front face only)
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                // Inline styles to force appearance without grid layout context
                cardEl.style.width = '300px';
                cardEl.style.aspectRatio = '3/4';
                cardEl.style.margin = '0';
                cardEl.style.transform = 'none';
                
                cardEl.innerHTML = `
                    <div class="card-inner" style="transform: none;">
                        <div class="card-front">
                            <div class="snomed-code">${card.code}</div>
                            <div class="graphic-frame">
                                ${card.icon}
                            </div>
                            <div class="description">${card.text}</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(cardEl);

                // Capture
                const canvas = await html2canvas(cardEl, {
                    scale: 2, // Retina quality
                    backgroundColor: null
                });

                // Download
                const link = document.createElement('a');
                link.download = `NHS-Card-${card.code}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                // Cleanup current card
                container.removeChild(cardEl);

                // Small delay to prevent browser throttling downloads
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            document.body.removeChild(container);
            btn.innerText = originalText;
            btn.disabled = false;
        }

        // Initial render
        renderCards();

    </script>
</body>
</html>
